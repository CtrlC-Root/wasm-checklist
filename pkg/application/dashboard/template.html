<!-- TODO: move this after <div> below but triggers a zts parsing bug -->
<script type="text/javascript">
(async () => {
  // create the script element dynamically so we can add event listeners to it
  // before the browser starts loading it and ensure we respond to the events
  const loadHtmxScript = new Promise((resolve, reject) => {
    const element = document.createElement('script');

    // https://htmx.org/docs/#installing
    element.setAttribute('src', 'https://unpkg.com/htmx.org@2.0.4');
    element.setAttribute('integrity', 'sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+');
    element.setAttribute('crossorigin', 'anonymous');

    // resolve or reject the promise
    element.addEventListener('load', resolve);
    element.addEventListener('error', reject);

    // script starts loading after it's added to the document here
    document.body.append(element);
  });

  // wait for the script to finish loading
  await loadHtmxScript;

  // https://stackoverflow.com/a/73659697
  // https://htmx.org/api/#process
  console.debug("trigger HTMX to process loaded body content");
  htmx.process(document.body);
})();
</script>

<style>
form {
  display: block;
  width: fit-content;
  padding: 0.5em;
  border: 1px solid #ccc;
}

form div {
  display: block;
  width: fit-content;
  margin: 0.25em 0;
}
</style>

<!-- content -->
<div id="app">
  .checklist-list-start
  <h1>Checklists</h1>
  <ul hx-target="closest li" hx-swap="outerHTML">
    .checklist-list-item
    <li id="checklist-{[id]}">
      <a href="/app/checklist/{[id]}">{[title]s}</a>
      <button hx-delete="/app/checklist/{[id]}">Delete</button>
    </li>
  .checklist-list-end
  </ul>

  .checklist-form-start
  <form hx-post="/app/checklist">
    <div>
      <label for="created_by_user_id">User:</label>
      <select id="created_by_user_id" name="created_by_user_id">
        <option value="1">John Doe</option>
        <option value="2">Jane Doe</option>
      </select>
    </div>

    <div>
      <label for="title">Title:</label>
      <input type="text" id="title" name="title">
    </div>

    <div>
      <button type="submit">Create</button>
    </div>
  </form>
.footer
</div>
